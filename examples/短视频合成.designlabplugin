{
  "poster": "data:image/png;base64,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RqOBEILHH3+cd7/73QRBQBRF3HvvvUxOTl5QuCuF2Cr0XalUgNUHYbWglCKbzVKr1drvPVdGSTabXZU/df4i/cojAS70nK33fd8nSZKnvd8pdNxEt7B79+52hfVyuUytVuP2229nYGCAhYUFbrrpJv7mb/6GMAyJooj5+XnGx8eZnp7GOcdtt93G1Vdfzb//+7/zjne8gy996UsUi0Wy2SzVapU//dM/ZWlpiW9961ts3LgR3/d58MEHGR4eptFosLS0xOjoKOVymTAM2/fV39/P3XffzUMPPcTXv/511qxZw9mzZ1FKsXnzZo4fP45zjuHhYebm5hgfH8day9TUFKVSCaUUS0tLjI2NobXmta99LX19ffzXf/3XJaljcknmYKUUO3bsaJ+s8opXvIKjR4+yuLhIkiQcOXKE/fv38/rXv553vvOdnDhxgmPHjrFnzx6OHDnC5OQkmzZtotFo0N/fz+joKM453v72t/M7v/M7fPCDH8QYw65duzh16hSZTIbFxUU2btzIn//5n7N3716SJOH6668nDEPuvvtuyuUyzjk2b97MVVddxWc++1n27NnDRz/6UT796U+zefNmxsbGmJiYYMuWLVxxxRUcOXKEnTt3ks/n+eEPf8jOnTvxfZ///M//5Pd///d57LHH+NGPfsR73vMe8vk8//Ef//G0IwdebHTci/Y8D2MMp0+f5vDhw/ziF79gYmKCkydPsnbtWqanpxkbG2NsbIwwDJmcnKRSqfDWt76V2dlZhBDs3r2bs2fPsnbtWqy1bNq0ic2bN7N7926SJOF1r7uJzZs3s2/fPv73f/+XYrHIG97wBoQQnDx5kiRJuPnmmwnDkFqthud5ba0ql8tMTU1RrVR485vfTK1W4y1veQtr167l4YcfZmFhga1bt3LmzBny+TwzMzMcOnSIm266if7+fmZnZ9tJdWvXrmX79u3ce++9jI+PMzQ0hG4eYNKx/u5YS6yerx599FFuuOEGgiDgySef5PTp03ziE5/gAx/4AF/96ldRSpHJZPi3f/s3kiThi1/8YlvTa7Uat956K1/5ylcYGhrif/7nfxBC8OUvf5mRkRGmp6eZm5vlwIEDOOeYnZ1lbm6Oq666ite85jV89rOf5R//8R9585vfzPLyMouLi23TGccx3//+9ykUCnzta1/jkUce4cSJE9Trdd7whjdwzz33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",
  "knowledge": {
    "readme": "## 短视频合成\n\n\n### 从本地文件合成短视频，并添加音乐",
    "course": ""
  },
  "code": "\n// 基础数据\nvar videos = {};\nlet videoObjId;\n\n// 变量区域-素材\nlet variables;\n\n// 扩展\nCanvas.prototype.addVariableRect = function (obj) {\n    return this.addRect({\n        left: obj.left,\n        top: obj.top,\n        width: obj.width,\n        height: obj.height,\n        fill: 'rgba(0,255,0,0.3)',\n        lockMovementX: false,\n        lockRotation: false,\n        lockScalingX: false,\n        lockScalingY: false,\n    }, true, true);\n}\n\n\nvar store = new Store('video_create_by_shadow');\nvar storeKey = (new Date()).getTime().toString();\nvar outputVideo;\n\n// 合成预览\n// 540*960\nvar _WIDTH = Math.min(parseInt(window.innerWidth * 0.8), 240),\n    _HEIGHT = parseInt(_WIDTH * 16 / 9),\n    _SCALE = 4,\n    _OUTPUTDIR = (() => {\n        let p = localStorage.getItem('_OUTPUTDIR');\n        return !!p ? p : null;\n    })();\n\n// UI\nlet pc, info, setupInfo;\n\n// 界面\nlet audioGroup, framesGroup;\nasync function gui() {\n    //隐藏p5的画布\n    Lab.base.p5Show(false);\n    Lab.base.layout(0);\n\n    setupInfo = Lab.base.createBaseText(_OUTPUTDIR || '设置路径');\n    setupInfo.style = `width: 86%;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;`;\n    let setupBtn = Lab.base.createIcon('setup', _setupFilePath, false);\n    let refreshBtn = Lab.base.createIcon(\"clear\", _newVideo, false);\n    // 设置路径、设置按钮、清空\n    let setupBtns = Lab.base.createGroup(setupInfo, setupBtn, refreshBtn);\n\n    setupBtns.layout(6);\n    //Lab.base.add(setupBtns);\n    // 合成视频\n    let createBtn = Lab.base.createIcon(\"play\", _createVideo, false);\n    info = Lab.base.createBaseText('开始合成吧！');\n    // let downloadBtn = Lab.base.createIcon('save', _downloadVideo, false);\n    let mainBtns = Lab.base.createGroup(createBtn, info);\n    mainBtns.layout(6);\n\n    let header = Lab.base.createGroup(setupBtns, mainBtns);\n    header.layout(6);\n    Lab.base.add(header);\n\n    //添加背景音乐 \n    audioGroup = Lab.base.createGroup(Lab.base.createIcon('music', () => {\n        Lab.base.toast('推荐背景音乐，待开发');\n    }, false));\n    audioGroup.layout(6);\n    Lab.base.add(audioGroup);\n\n    // 帧\n    framesGroup = Lab.base.createGroup();\n    framesGroup.style.padding = '24px';\n    framesGroup.layout(6);\n\n    //framesGroup.children = {};\n    Lab.base.add(framesGroup);\n\n    // 添加帧\n    createAddCard();\n\n    let editBtn = Lab.base.createIcon(\"square\", _newRect, false);\n    let textBtn = Lab.base.createIcon(\"comment\", _newText, false);\n    let copyBtn = Lab.base.createIcon(\"plus\", _addVariableElements, false);\n    let editGroup = Lab.base.createGroup(editBtn, textBtn, copyBtn);\n    editGroup.layout(6);\n    Lab.base.add(editGroup);\n\n    pc = new Canvas(_WIDTH, _HEIGHT, false, false);\n\n\n    let previewGroup = Lab.base.createGroup(pc.getElement());\n    previewGroup.layout(0);\n    Lab.base.add(previewGroup);\n\n    // 变量区域-素材\n    let rectInfo = Lab.base.createBaseText('变量区域-素材');\n    variables = Lab.base.createGroup(rectInfo);\n    variables.layout(6);\n    Lab.base.add(variables);\n\n    // 字幕生成\n    const createTextImageAndUpdate = (text, style) => {\n        let id = Lab.base.hash({ text, style });\n        console.log(videos, videoObjId)\n        if (id != videos[videoObjId].textId) {\n            videos[videoObjId] = Object.assign(videos[videoObjId], {\n                textId: id,\n                text,\n                textImage: createTextImage(text, style)\n            })\n        }\n    };\n    // 绑定事件\n    pc.onModified = (opt, json) => {\n        // 矩形变量更改\n        console.log(opt.target.type, opt.target)\n        if (opt.target.type == 'rect') {\n            let index = null;\n\n            // for (let i = 0; i < variables.length; i++) {\n            //     if (variables[i].videoObjId === videoObjId) {\n            //         index = i;\n            //     }\n            // }\n            if (index != null) {\n                videos[videoObjId].variableRect = opt.target.getScaledBound();\n                console.log('更新变量区域', videos[videoObjId])\n            }\n\n        }\n        // 文本修改信息\n        if (opt.target.type === 'textbox') {\n            let style = textStyleExtract(opt.target);\n            const { text } = opt.target;\n            createTextImageAndUpdate(text, style);\n        };\n        // 布局信息\n        updateData(videoObjId, json);\n        // 更新预览图\n        updatePreviewImg(videoObjId);\n    };\n\n    pc.render(true)\n};\n\nasync function createVideoPreview(url) {\n    outputVideo = await Lab.base.createVideo(url,\n        false);\n    outputVideo.style.width = _WIDTH + 'px';\n    outputVideo.style.height = _HEIGHT + 'px';\n    outputVideo.play();\n}\n\nasync function createAddCard() {\n    let addBtn = Lab.base.createIcon(\"plus\", _addVideo, false);\n    let imBtn = Lab.base.createButton(\"\", () => { }, false);\n    imBtn.appendChild(addBtn);\n    addBtn.style.width = '56px';\n    addBtn.style.borderRadius = 0;\n    addBtn.style.color = '#4a4a4a';\n    addBtn.style.background = 'rgba(255,255,255,0.1)';\n    addBtn.style.height = `${_HEIGHT * 56 / _WIDTH}px`\n    addBtn.style.margin = '2px';\n    imBtn.style = `\n    height: auto;\n    background: #eee;\n    border-radius: 8px;\n    padding: 0;`;\n    framesGroup.appendChild(imBtn);\n};\n\n\nasync function _addVariableElements() {\n    let rectInfo = Lab.base.createBaseText('变量区域-素材');\n    // 关键帧的可变区域-素材集\n    videos[videoObjId].variableElements = await Lab.base.createShortVideoInput();\n    if (videos[videoObjId].variableElements) {\n        rectInfo.innerText = `变量区域-素材${videos[videoObjId].variableElements.length}`;\n    };\n    variables.innerHTML = '';\n    variables.appendChild(rectInfo);\n    _save();\n};\n\nfunction _addVariableRect2UI(videoObjId) {\n    // variables.push({\n    //     videoObjId: videoObjId\n    // });\n\n    // 已经绑定了变量素材\n    if (videos[videoObjId].variableElements) {\n        let rectInfo = Lab.base.createBaseText('变量区域-素材');\n        rectInfo.innerText = `变量区域-素材${videos[videoObjId].variableElements.length}`;\n        variables.innerHTML = '';\n        variables.appendChild(rectInfo);\n    } else {\n        let rectInfo = Lab.base.createBaseText('变量区域-素材');\n        variables.innerHTML = '';\n        variables.appendChild(rectInfo);\n    }\n\n\n    // let g = Lab.base.createGroup(rectBtn, rectInfo);\n    // g.layout(6);\n    // Lab.base.add(g);\n}\n\n\n// 添加素材\nasync function _addVideo() {\n    let labVideos = Lab.base.createShortVideoInput();\n    // console.log(labVideos)\n    if (labVideos) {\n\n        for (let labVideo of labVideos) {\n            // 帧数据\n            labVideo = await baseData(labVideo);\n\n            videos[labVideo.id] = labVideo;\n\n            if (labVideo.type === 'audio') {\n                await baseAddBackgroundAudio(labVideo);\n            } else {\n                await baseAddVideo(labVideo);\n            }\n\n            updateData(labVideo.id);\n        }\n\n    }\n\n}\n// 结果\nasync function _createVideo() {\n    if (!_OUTPUTDIR) _setupFilePath();\n    if (!_OUTPUTDIR) return\n    info.innerText = '正在合成ing';\n    let finishData = createVideoData();\n    if (finishData.frames.length > 0) {\n        Lab.base.loading(0);\n        let src = await Lab.video.mergeAll(finishData, (progress) => {\n            info.innerText = progress.toFixed(2);\n        });\n        await createVideoPreview(src);\n        Lab.base.loading(100);\n        // Lab.base.toast('完成' + outputVideo.src);\n        _save();\n    }\n\n}\n\nfunction _setupFilePath() {\n    // console.log('filePath')\n    let filePath = Lab.base.getFilePath(2);\n    if (filePath && filePath[0]) {\n        _OUTPUTDIR = filePath[0];\n        Lab.video.newDirname = _OUTPUTDIR;\n        setupInfo.innerText = _OUTPUTDIR;\n        localStorage.setItem('_OUTPUTDIR', _OUTPUTDIR);\n        Lab.video.newDirname=_OUTPUTDIR;\n    }\n    return _OUTPUTDIR\n    // console.log(filePath)\n}\nasync function _newVideo() {\n    await store.clear();\n    videos = {};\n    videoObjId = null;\n    // 变量区域-素材\n    variables = null;\n    Lab.base.clear();\n    gui();\n}\n\nfunction _newRect() {\n    // 暂时只支持一个变量区域\n    if (videos[videoObjId].variableRect) return\n    let rect = pc.addVariableRect({\n        left: 0,\n        top: 0,\n        width: _WIDTH,\n        height: _WIDTH\n    });\n\n    videos[videoObjId].variableRect = rect.getScaledBound();\n\n    // console.log(rect);\n    _addVariableRect2UI(videoObjId);\n\n}\n\n\n// 复制当前的变量区域 到全部\n// function _copyRect() {\n//     if (!videos[videoObjId].variableRect) return\n//     let v = JSON.parse(JSON.stringify(videos[videoObjId].variableRect));\n//     // variables.push({rect:variables[0].rect,videoObjId:'a555a9c614d00029c2b0ac20063bcf33bbfb67cf'})\n//     for (var id in videos) {\n//         if (!videos[id].variableRect) {\n//             variables.push({ videoObjId: id });\n//             _addVariableRect2UI(id);\n//         };\n//         videos[id].variableRect = v;\n//     };\n// };\n\n// 添加字幕\nfunction _newText() {\n    if (!videos[videoObjId].text) pc.addText('TEXT', getTextStyle());\n};\n\n// 关键帧数据\nconst createFrameData = (labVideo) => {\n    let { index, url, type, layout, createTime, id, text, textImage } = labVideo;\n    if (!((index != null || index != undefined) && typeof index === 'number')) index = Object.keys(videos).length;\n    let obj = {\n        index,\n        type,\n        url,\n        text,\n        textImage,\n        layout,\n        createTime: createTime || (new Date()).getTime()\n    };\n    if (!id) {\n        obj.id = Lab.base.hash(obj)\n    } else {\n        obj.id = id;\n    };\n\n    return obj;\n};\n\nconst createTextImage = (text, style) => {\n    let tc = new Canvas(_WIDTH, _HEIGHT, true, false);\n    tc.addText(text, style, false, false);\n    // console.log(style)\n    //TODO  调试\n    // document.body.appendChild(tc.getElement())\n    return tc.toDataURL(_SCALE);\n};\n\n// 计算字幕的停留时间\nconst getTextLoop = text => {\n    text = text || '';\n    return Math.max(parseInt(text.length / 2.5), 5)\n}\n\n// 取布局数据\nconst getLayout = (obj) => {\n    let { top, left, width, height, scaleX, scaleY, angle } = obj;\n    scaleX = scaleX || 1;\n    scaleY = scaleY || 1;\n    return {\n        angle: angle || 0,\n        top: parseInt(top * _SCALE),\n        left: parseInt(left * _SCALE),\n        width: Math.min(parseInt(width * _SCALE * scaleX), _WIDTH * _SCALE),\n        height: Math.min(parseInt(height * _SCALE * scaleY), _HEIGHT * _SCALE)\n    }\n};\n\n\n// 文本的样式\nconst textStyleExtract = obj => {\n    let res;\n    if (obj) {\n        const { top,\n            left,\n            width,\n            height,\n            fill,\n            fontSize,\n            charSpacing,\n            fontFamily,\n            angle,\n            scaleX,\n            scaleY\n        } = obj;\n        res = {\n            top,\n            left,\n            width,\n            height,\n            fill,\n            fontSize,\n            charSpacing: charSpacing || 0,\n            fontFamily,\n            angle: angle || 0,\n            scaleX: scaleX || 1,\n            scaleY: scaleY || 1\n        }\n    } else {\n        res = {\n            top: parseInt(_HEIGHT * 0.1),\n            left: 0,\n            width: _WIDTH,\n            fontSize: parseInt(_HEIGHT * 0.05),\n            fill: \"white\",\n            fontFamily: 'monospace'\n        }\n    }\n    return res\n\n}\n\n// 内容样式\n// 计算居中\nconst contentStyleExtract = (obj, element) => {\n    let res;\n    if (obj) {\n        // width,height是元素真实的尺寸，通过scale来缩放成最终的高宽\n        const { left, top, width, height, angle, scaleX, scaleY } = obj;\n        // console.log(width, height, scaleX, scaleY)\n        res = {\n            left, top,\n            width, height,\n            scaleX: scaleX || 1, scaleY: scaleY || 1,\n            angle: angle || 0\n        }\n    } else {\n        let width = element.width, height = element.height;\n        let scale = _WIDTH / element.width;\n        if (width < _WIDTH) {\n            scale = element.width / _WIDTH;\n        };\n\n        scale = parseFloat(scale.toFixed(2));\n\n        res = {\n            left: parseInt((_WIDTH - width * scale) / 2),\n            top: parseInt((_HEIGHT - height * scale) / 2),\n            width, height,\n            scaleX: scale, scaleY: scale,\n            angle: 0\n        }\n        // console.log(res)\n    }\n    return res\n}\n\nconst getContentStyle = (layout, element) => {\n    let target = layout ? layout.filter(f => f.type === 'image')[0] : null;\n    let res = contentStyleExtract(target, element);\n    // console.log(res)\n    return res\n};\n\nconst getTextStyle = (layout) => {\n    let target = layout ? layout.filter(f => f.type === 'textbox')[0] : null;\n    let res = textStyleExtract(target);\n    return res\n}\n\n// 准备绘制 字幕的数据\nconst getTextAndStyle = labVideo => {\n    // 文字输入\n    let style = getTextStyle(labVideo.layout),\n        text = null;\n    // console.log(textStyle)\n    if (labVideo.text) {\n        text = labVideo.text;\n    };\n    return {\n        element: text,\n        style\n    }\n}\n// 准备绘制 内容的数据\nconst getContentAndStyle = async labVideo => {\n    // 元素\n    let element;\n    if (labVideo.type == \"video\") {\n        element = await Lab.base.createVideo(labVideo.url, false);\n\n    } else if (labVideo.type == \"img\") {\n        element = await Lab.base.createImage(labVideo.url);\n    } else if (labVideo.type == \"gif\") {\n        // let frames = await pc.buildSprite(labVideo.url,pc.canvas);\n        // console.log(frames)\n        if (!labVideo.videoUrl) {\n            let videoUrl = await Lab.video.gif2video(labVideo.url);\n            // console.log(videoUrl)\n            labVideo.videoUrl = videoUrl;\n        };\n\n        element = await Lab.base.createVideo(labVideo.videoUrl, false);\n\n    }\n    // 样式\n    let style = getContentStyle(labVideo.layout, element);\n    return {\n        element,\n        style\n    }\n}\n\nasync function createPreviewImg(id) {\n    let base64 = pc.toDataURL(1);\n\n    //创建图片\n    let im = await Lab.base.createImage(base64);\n    im.style.width = '56px';\n    im.style.margin = '2px';\n    im.id = id;\n    let imBtn = Lab.base.createButton(\"\", async () => {\n        videoObjId = id;\n        await baseAddVideo(videos[id], false);\n        updateData(id);\n        _addVariableRect2UI(videoObjId);\n    }, false);\n    imBtn.appendChild(im);\n    imBtn.style = `\n    height: auto;\n    background: #eee;\n    border-radius: 8px;\n    padding: 0;`;\n    framesGroup.appendChild(imBtn);\n    framesGroup.children[id] = im;\n    videos[id].preview = im.src;\n}\n\nfunction updatePreviewImg(id) {\n    let base64 = pc.toDataURL(1);\n    //更新图片\n    if (framesGroup.children[id]) framesGroup.children[id].src = base64;\n    videos[id].preview = base64;\n}\n\n\n// 用来合成视频的数据\nfunction createVideoData() {\n    // 背景音乐\n    let backgroudAudio = null;\n    let _videos = videos2array();\n    var videosNew = Array.from(_videos, v => {\n        if (v && v.url) {\n            let index = v.index;\n            let textImage = null;\n            let content = null;\n            let variable = v.variableElements && v.variableRect ? {\n                elements: v.variableElements,\n                rect: v.variableRect\n            } : null;\n            // console.log(v)\n            if (v.type === 'gif') {\n                v.type = 'video';\n                v.url = v.videoUrl;\n            };\n            if (v.type === 'audio') {\n                backgroudAudio = v;\n            } else {\n                Array.from(v.layout || [], l => {\n                    // console.log(l)\n                    if (l.type == 'textbox') {\n                        textImage = {\n                            text: v.text,\n                            base64: v.textImage,\n                            loop: getTextLoop(v.text),\n                            layout: getLayout(l)\n                        };\n                        if (!v.text) textImage = null;\n                    } else if (l.type == 'image') {\n                        content = {\n                            type: v.type,\n                            url: v.url,\n                            // loop: 5,\n                            layout: getLayout(l)\n                        };\n                    };\n\n                });\n            };\n            return (content || textImage) ? {\n                index,\n                content,\n                textImage,\n                variable\n            } : null\n        }\n    }).filter(f => f);\n    let finishData = {\n        width: _WIDTH * _SCALE,\n        height: _HEIGHT * _SCALE,\n        // 按照index升序\n        frames: videosNew.sort((a, b) => a.index - b.index),\n        backgroudAudio: backgroudAudio\n    };\n    // console.log(finishData)\n    return finishData\n}\n\n// 笛卡尔积\nfunction ddd() {\n    // TODO\n}\n\n// 更新布局layout\nconst updateLayout = json => {\n    return Array.from(json.objects, o => {\n        // console.log(o)\n        let no = { left: o.left, top: o.top, width: o.width, height: o.height, type: o.type };\n        if (o.type == 'textbox') {\n            no = Object.assign(no, textStyleExtract(o))\n        } else if (o.type == 'image') {\n            no = Object.assign(no, contentStyleExtract(o))\n        }\n        return no\n    });\n};\n\nasync function baseData(labVideo) {\n    // 帧数据\n    let videoObj = createFrameData(labVideo);\n    labVideo.type !== 'audio' ? videoObjId = videoObj.id : null;\n    // 去重？?\n    // if (Array.from(videos, v => v.id).includes(videoObj.id)) return console.log(labVideo);\n    if (labVideo.type == 'audio') {\n        //背景音乐\n        let element = await Lab.base.createaAudio(labVideo.url, false);\n        videoObj = Object.assign(videoObj, {\n            duration: element.duration,\n            startTime: 0,\n            loop: 5\n        })\n    };\n    return videoObj\n}\n\nfunction updateData(id, json) {\n    // console.log('更新数据',videos[id],json)\n    // console.log(updateLayout(json))\n    videos[id] = Object.assign(videos[id], {\n        layout: updateLayout(json || pc.exportJSON())\n    })\n    _save();\n}\n\nasync function baseAddBackgroundAudio(labVideo) {\n    if (audioGroup.querySelector('audio')) audioGroup.querySelector('audio').remove();\n    audioGroup.appendChild(await Lab.base.createaAudio(labVideo.url, false));\n}\n\n\nasync function baseAddVideo(labVideo, isNew = true) {\n    // console.log(labVideo)\n    //  console.log(labVideo.preview)\n    // _addVariableRect2UI(rect, videoObjId);\n    let variableRect;\n\n    if (labVideo) {\n\n        //添加到画布 \n        pc.reset();\n        // 背景\n        pc.addRect({\n            width: _WIDTH,\n            height: _HEIGHT,\n            fill: 'black',\n            stroke: 'black'\n        }, false);\n\n        // 内容 把type==gif的转化为video\n        let { element, style } = await getContentAndStyle(labVideo);\n        // console.log(labVideo)\n        if (labVideo.type == \"video\" || labVideo.type == \"gif\") {\n            pc.addVideo(element,\n                Object.assign(style, {\n                    objectCaching: false,\n                    lockMovementX: false,\n                    lockRotation: false,\n                    lockScalingX: false,\n                    lockScalingY: false,\n                }), true, false);\n        } else if (labVideo.type == \"img\") {\n            pc.addImg(element, style);\n        };\n\n        // 字幕\n        let { element: text, style: ts } = getTextAndStyle(labVideo);\n        if (text) pc.addText(text, ts);\n\n        // 变量区域\n        if (labVideo.variableRect) {\n            // console.log(variableRect)\n            variableRect = pc.addRect({\n                left: labVideo.variableRect.left,\n                top: labVideo.variableRect.top,\n                width: labVideo.variableRect.width,\n                height: labVideo.variableRect.height,\n                fill: 'rgba(0,255,0,0.3)',\n                lockMovementX: false,\n                lockRotation: false,\n                lockScalingX: false,\n                lockScalingY: false,\n            }, true, true);\n        }\n\n        //最后\n        // 创建预览图片\n        await sleep(() => (isNew === true) ? createPreviewImg(labVideo.id) : updatePreviewImg(labVideo.id), 200);\n\n    };\n\n    return variableRect;\n};\n\nfunction sleep(fn, t = 500) {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => {\n            if (fn) fn();\n            resolve();\n        }, t);\n    });\n}\n\n// 缓存\nstore.getValues().then(async vs => {\n    // console.log(vs)\n    await store.clear();\n    if (vs[0]) {\n        _WIDTH = vs[0].width;\n        _HEIGHT = vs[0].height;\n        _SCALE = vs[0].scale;\n        if (outputVideo && outputVideo.src) (outputVideo.src = vs[0].outputVideo) && outputVideo.play();\n        let ds = (vs[0].videos || []);\n        ds = ds.sort((a, b) => a.index - b.index);\n        for (let i = 0; i < ds.length; i++) {\n            videos[ds[i].id] = ds[i];\n            let variableRect;\n            if (ds[i].type === 'audio') {\n                await baseAddBackgroundAudio(ds[i]);\n            } else {\n                variableRect = await baseAddVideo(ds[i]);\n            };\n\n            videoObjId = ds[i].id;\n            // 变量\n            // if (variableRect) {\n            _addVariableRect2UI(videoObjId);\n            // console.log(ds[i].variableElements);\n            // };\n\n        };\n        _save();\n    }\n});\n// videos object转array\nfunction videos2array() {\n    let vs = [];\n    for (let id in videos) {\n        vs.push(videos[id])\n    };\n    vs = vs.sort((a, b) => a.index - b.index);\n    return vs;\n};\n// 保存\nfunction _save() {\n    let vs = videos2array();\n    store.set(storeKey, {\n        videos: vs,\n        width: _WIDTH,\n        height: _HEIGHT,\n        scale: _SCALE,\n        outputVideo: outputVideo && outputVideo.src && outputVideo.src.match('.mp4') ? outputVideo.src : null\n    });\n}\n\n",
  "code_length": 169,
  "size": [
    365,
    660
  ],
  "extname": "designlabplugin",
  "version": "0.1.1",
  "package_id": "6c0d6a60e7421c3dc2106363f3843cc75805d743",
  "create_time": 1617077270261
}