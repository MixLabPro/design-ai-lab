{
  "poster": "data:image/png;base64,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",
  "knowledge": {
    "readme": "## 短视频合成\n\n\n### 从本地文件合成短视频，并添加音乐",
    "course": ""
  },
  "code": "\n// 基础数据\nvar videos = {};\nlet videoObjId;\n\n// 保存变量\nlet variables = [];\n\n// 扩展\nCanvas.prototype.addVariableRect = function (obj) {\n    return this.addRect({\n        left: obj.left,\n        top: obj.top,\n        width: obj.width,\n        height: obj.height,\n        fill: 'rgba(0,255,0,0.3)',\n        lockMovementX: false,\n        lockRotation: false,\n        lockScalingX: false,\n        lockScalingY: false,\n    }, true, true);\n}\n\n\nvar store = new Store('video_create_by_shadow');\nvar storeKey = (new Date()).getTime().toString();\nvar outputVideo;\n\n// 合成预览\n// 540*960\nvar _WIDTH = Math.min(parseInt(window.innerWidth * 0.8), 240),\n    _HEIGHT = parseInt(_WIDTH * 16 / 9),\n    _SCALE = 4,\n    _OUTPUTDIR = (() => {\n        let p = localStorage.getItem('_OUTPUTDIR');\n        return !!p ? p : null;\n    })();\n\n// UI\nlet pc, info, setupInfo;\n\n// 界面\nlet audioGroup, framesGroup;\nasync function gui() {\n    //隐藏p5的画布\n    Lab.base.p5Show(false);\n    Lab.base.layout(0);\n\n    setupInfo = Lab.base.createBaseText(_OUTPUTDIR || '设置路径');\n    setupInfo.style = `width: 86%;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;`;\n    let setupBtn = Lab.base.createIcon('setup', _setupFilePath, false);\n    let refreshBtn = Lab.base.createIcon(\"clear\", _newVideo, false);\n\n    let setupBtns = Lab.base.createGroup(setupInfo, setupBtn, refreshBtn);\n\n    setupBtns.layout(6);\n    //Lab.base.add(setupBtns);\n\n    let createBtn = Lab.base.createIcon(\"play\", _createVideo, false);\n    info = Lab.base.createBaseText('开始合成吧！');\n    // let downloadBtn = Lab.base.createIcon('save', _downloadVideo, false);\n    let mainBtns = Lab.base.createGroup(createBtn, info);\n    mainBtns.layout(6);\n\n    let header = Lab.base.createGroup(setupBtns, mainBtns);\n    header.layout(6);\n    Lab.base.add(header);\n\n    audioGroup = Lab.base.createGroup(Lab.base.createIcon('music', () => {\n        Lab.base.toast('推荐背景音乐，待开发');\n    }, false));\n    audioGroup.layout(6);\n    Lab.base.add(audioGroup);\n\n    framesGroup = Lab.base.createGroup();\n    framesGroup.style.padding = '24px';\n    framesGroup.layout(6);\n\n    //framesGroup.children = {};\n    Lab.base.add(framesGroup);\n\n    let editBtn = Lab.base.createIcon(\"square\", _newRect, false);\n    let textBtn = Lab.base.createIcon(\"comment\", _newText, false);\n    let copyBtn = Lab.base.createIcon(\"copy\", _copyRect, false);\n    let editGroup = Lab.base.createGroup(editBtn, textBtn, copyBtn);\n    editGroup.layout(6);\n    Lab.base.add(editGroup);\n\n    pc = new Canvas(_WIDTH, _HEIGHT, false, false);\n\n\n    let previewGroup = Lab.base.createGroup(pc.getElement());\n    previewGroup.layout(0);\n    Lab.base.add(previewGroup);\n\n    createAddCard();\n\n    // 字幕生成\n    const createTextImageAndUpdate = (text, style) => {\n        let id = Lab.base.hash({ text, style });\n        console.log(videos, videoObjId)\n        if (id != videos[videoObjId].textId) {\n            videos[videoObjId] = Object.assign(videos[videoObjId], {\n                textId: id,\n                text,\n                textImage: createTextImage(text, style)\n            })\n        }\n    };\n    // 绑定事件\n    pc.onModified = (opt, json) => {\n        // 矩形变量更改\n        console.log(opt.target.type, opt.target)\n        if (opt.target.type == 'rect') {\n            let index = null;\n\n            for (let i = 0; i < variables.length; i++) {\n                if (variables[i].videoObjId === videoObjId) {\n                    index = i;\n                }\n            }\n            if (index != null) {\n                videos[videoObjId].variableRect = opt.target.getScaledBound();\n                console.log('更新变量区域', videos[videoObjId], variables[index])\n            }\n\n        }\n        // 文本修改信息\n        if (opt.target.type === 'textbox') {\n            let style = textStyleExtract(opt.target);\n            const { text } = opt.target;\n            createTextImageAndUpdate(text, style);\n        };\n        // 布局信息\n        updateData(videoObjId, json);\n        // 更新预览图\n        updatePreviewImg(videoObjId);\n    };\n\n\n};\n\nasync function createVideoPreview(url) {\n    outputVideo = await Lab.base.createVideo(url,\n        false);\n    outputVideo.style.width = _WIDTH + 'px';\n    outputVideo.style.height = _HEIGHT + 'px';\n    outputVideo.play();\n}\n\nasync function createAddCard() {\n    let addBtn = Lab.base.createIcon(\"plus\", _addVideo, false);\n    let imBtn = Lab.base.createButton(\"\", () => { }, false);\n    imBtn.appendChild(addBtn);\n    addBtn.style.width = '56px';\n    addBtn.style.borderRadius = 0;\n    addBtn.style.color = '#4a4a4a';\n    addBtn.style.background = 'rgba(255,255,255,0.1)';\n    addBtn.style.height = `${_HEIGHT * 56 / _WIDTH}px`\n    addBtn.style.margin = '2px';\n    imBtn.style = `\n    height: auto;\n    background: #eee;\n    border-radius: 8px;\n    padding: 0;`;\n    framesGroup.appendChild(imBtn);\n}\n\n\n// 添加素材\nasync function _addVideo() {\n    let labVideos = Lab.base.createShortVideoInput();\n    // console.log(labVideos)\n    if (labVideos) {\n\n        for (let labVideo of labVideos) {\n            // 帧数据\n            labVideo = await baseData(labVideo);\n\n            videos[labVideo.id] = labVideo;\n\n            if (labVideo.type === 'audio') {\n                await baseAddBackgroundAudio(labVideo);\n            } else {\n                await baseAddVideo(labVideo);\n            }\n\n            updateData(labVideo.id);\n        }\n\n    }\n\n}\n// 结果\nasync function _createVideo() {\n    if (!_OUTPUTDIR) _setupFilePath();\n    if (!_OUTPUTDIR) return\n    info.innerText = '正在合成ing';\n    let finishData = createVideoData();\n    if (finishData.frames.length > 0) {\n        Lab.base.loading(0);\n        let src = await Lab.video.mergeAll(finishData, (progress) => {\n            info.innerText = progress.toFixed(2);\n        });\n        await createVideoPreview(src);\n        Lab.base.loading(100);\n        // Lab.base.toast('完成' + outputVideo.src);\n        _save();\n    }\n\n}\n\nfunction _setupFilePath() {\n    // console.log('filePath')\n    let filePath = Lab.base.getFilePath(2);\n    if (filePath && filePath[0]) {\n        _OUTPUTDIR = filePath[0];\n        Lab.video.newDirname = _OUTPUTDIR;\n        setupInfo.innerText = _OUTPUTDIR;\n        localStorage.setItem('_OUTPUTDIR', _OUTPUTDIR);\n    }\n    return _OUTPUTDIR\n    // console.log(filePath)\n}\nasync function _newVideo() {\n    await store.clear();\n    Lab.base.clear();\n    gui();\n}\n\nfunction _newRect() {\n    // 暂时只支持一个变量区域\n    if (variables.filter(v => v.videoObjId === videoObjId).length > 0) return\n    let rect = pc.addVariableRect({\n        left: 0,\n        top: 0,\n        width: _WIDTH,\n        height: _WIDTH\n    });\n\n    videos[videoObjId].variableRect = rect.getScaledBound();\n\n    // console.log(rect);\n    _addVariableRect2UI(videoObjId);\n\n}\n\nfunction _addVariableRect2UI(videoObjId) {\n    variables.push({\n        videoObjId: videoObjId\n    });\n    let rectInfo = Lab.base.createBaseText('素材');\n    let rectBtn = Lab.base.createIcon('plus', async () => {\n        videos[videoObjId].variableElements = await Lab.base.createShortVideoInput();\n        if (videos[videoObjId].variableElements) {\n            rectInfo.innerText = `素材${videos[videoObjId].variableElements.length}`;\n        }\n    });\n\n    let g = Lab.base.createGroup(rectBtn, rectInfo);\n    g.layout(6);\n    Lab.base.add(g);\n}\n\n// 复制当前的变量区域 到全部\nfunction _copyRect() {\n    if (!videos[videoObjId].variableRect) return\n    let v = JSON.parse(JSON.stringify(videos[videoObjId].variableRect));\n    // variables.push({rect:variables[0].rect,videoObjId:'a555a9c614d00029c2b0ac20063bcf33bbfb67cf'})\n    for (var id in videos) {\n        if (!videos[id].variableRect) {\n            variables.push({ videoObjId: id });\n            _addVariableRect2UI(id);\n        };\n        videos[id].variableRect = v;\n    };\n};\n\n// 添加字幕\nfunction _newText() {\n    pc.addText('TEXT', getTextStyle());\n};\n\n// 关键帧数据\nconst createFrameData = (labVideo) => {\n    let { index, url, type, layout, createTime, id, text, textImage } = labVideo;\n    if (!((index != null || index != undefined) && typeof index === 'number')) index = Object.keys(videos).length;\n    let obj = {\n        index,\n        type,\n        url,\n        text,\n        textImage,\n        layout,\n        createTime: createTime || (new Date()).getTime()\n    };\n    if (!id) {\n        obj.id = Lab.base.hash(obj)\n    } else {\n        obj.id = id;\n    };\n\n    return obj;\n};\n\nconst createTextImage = (text, style) => {\n    let tc = new Canvas(_WIDTH, _HEIGHT, true, false);\n    tc.addText(text, style, false, false);\n    // console.log(style)\n    //TODO  调试\n    // document.body.appendChild(tc.getElement())\n    return tc.toDataURL(_SCALE);\n};\n\n// 计算字幕的停留时间\nconst getTextLoop = text => {\n    text = text || '';\n    return Math.max(parseInt(text.length / 2.5), 5)\n}\n\n// 取布局数据\nconst getLayout = (obj) => {\n    let { top, left, width, height, scaleX, scaleY, angle } = obj;\n    scaleX = scaleX || 1;\n    scaleY = scaleY || 1;\n    return {\n        angle: angle || 0,\n        top: parseInt(top * _SCALE),\n        left: parseInt(left * _SCALE),\n        width: Math.min(parseInt(width * _SCALE * scaleX), _WIDTH * _SCALE),\n        height: Math.min(parseInt(height * _SCALE * scaleY), _HEIGHT * _SCALE)\n    }\n};\n\n\n// 文本的样式\nconst textStyleExtract = obj => {\n    let res;\n    if (obj) {\n        const { top,\n            left,\n            width,\n            height,\n            fill,\n            fontSize,\n            charSpacing,\n            fontFamily,\n            angle,\n            scaleX,\n            scaleY\n        } = obj;\n        res = {\n            top,\n            left,\n            width,\n            height,\n            fill,\n            fontSize,\n            charSpacing: charSpacing || 0,\n            fontFamily,\n            angle: angle || 0,\n            scaleX: scaleX || 1,\n            scaleY: scaleY || 1\n        }\n    } else {\n        res = {\n            top: parseInt(_HEIGHT * 0.1),\n            left: 0,\n            width: _WIDTH,\n            fontSize: parseInt(_HEIGHT * 0.05),\n            fill: \"white\",\n            fontFamily: 'monospace'\n        }\n    }\n    return res\n\n}\n\n// 内容样式\n// 计算居中\nconst contentStyleExtract = (obj, element) => {\n    let res;\n    if (obj) {\n        // width,height是元素真实的尺寸，通过scale来缩放成最终的高宽\n        const { left, top, width, height, angle, scaleX, scaleY } = obj;\n        // console.log(width, height, scaleX, scaleY)\n        res = {\n            left, top,\n            width, height,\n            scaleX: scaleX || 1, scaleY: scaleY || 1,\n            angle: angle || 0\n        }\n    } else {\n        let width = element.width, height = element.height;\n        let scale = _WIDTH / element.width;\n        if (width < _WIDTH) {\n            scale = element.width / _WIDTH;\n        };\n\n        scale = parseFloat(scale.toFixed(2));\n\n        res = {\n            left: parseInt((_WIDTH - width * scale) / 2),\n            top: parseInt((_HEIGHT - height * scale) / 2),\n            width, height,\n            scaleX: scale, scaleY: scale,\n            angle: 0\n        }\n        // console.log(res)\n    }\n    return res\n}\n\nconst getContentStyle = (layout, element) => {\n    let target = layout ? layout.filter(f => f.type === 'image')[0] : null;\n    let res = contentStyleExtract(target, element);\n    // console.log(res)\n    return res\n};\n\nconst getTextStyle = (layout) => {\n    let target = layout ? layout.filter(f => f.type === 'textbox')[0] : null;\n    let res = textStyleExtract(target);\n    return res\n}\n\n// 准备绘制 字幕的数据\nconst getTextAndStyle = labVideo => {\n    // 文字输入\n    let style = getTextStyle(labVideo.layout),\n        text = null;\n    // console.log(textStyle)\n    if (labVideo.text) {\n        text = labVideo.text;\n    };\n    return {\n        element: text,\n        style\n    }\n}\n// 准备绘制 内容的数据\nconst getContentAndStyle = async labVideo => {\n    // 元素\n    let element;\n    if (labVideo.type == \"video\") {\n        element = await Lab.base.createVideo(labVideo.url, false);\n    } else if (labVideo.type == \"img\") {\n        element = await Lab.base.createImage(labVideo.url);\n    };\n    // 样式\n    let style = getContentStyle(labVideo.layout, element);\n    return {\n        element,\n        style\n    }\n}\n\nasync function createPreviewImg(id) {\n    let base64 = pc.toDataURL(1);\n\n    //创建图片\n    let im = await Lab.base.createImage(base64);\n    im.style.width = '56px';\n    im.style.margin = '2px';\n    im.id = id;\n    let imBtn = Lab.base.createButton(\"\", async () => {\n        videoObjId = id;\n        await baseAddVideo(videos[id], false);\n        updateData(id);\n    }, false);\n    imBtn.appendChild(im);\n    imBtn.style = `\n    height: auto;\n    background: #eee;\n    border-radius: 8px;\n    padding: 0;`;\n    framesGroup.appendChild(imBtn);\n    framesGroup.children[id] = im;\n    videos[id].preview = im.src;\n}\n\nfunction updatePreviewImg(id) {\n    let base64 = pc.toDataURL(1);\n    //更新图片\n    if (framesGroup.children[id]) framesGroup.children[id].src = base64;\n    videos[id].preview = base64;\n}\n\n\n\nfunction createVideoData() {\n    // 背景音乐\n    let backgroudAudio = null;\n    let _videos = videos2array();\n    var videosNew = Array.from(_videos, v => {\n        if (v && v.url) {\n            let index = v.index;\n            let textImage = null;\n            let content = null;\n            // console.log(v)\n            if (v.type === 'audio') {\n                backgroudAudio = v;\n            } else {\n                Array.from(v.layout || [], l => {\n                    //console.log(l)\n                    if (l.type == 'textbox') {\n                        textImage = {\n                            text: v.text,\n                            base64: v.textImage,\n                            loop: getTextLoop(v.text),\n                            layout: getLayout(l)\n                        };\n                        if (!v.text) textImage = null;\n                    } else if (l.type == 'image') {\n\n                        content = {\n                            type: v.type,\n                            url: v.url,\n                            // loop: 5,\n                            layout: getLayout(l)\n                        };\n                    };\n\n                });\n            }\n            return (content || textImage) ? {\n                index,\n                content,\n                textImage\n            } : null\n        }\n    }).filter(f => f);\n    let finishData = {\n        width: _WIDTH * _SCALE,\n        height: _HEIGHT * _SCALE,\n        // 按照index升序\n        frames: videosNew.sort((a, b) => a.index - b.index),\n        backgroudAudio: backgroudAudio\n    };\n    // console.log(finishData)\n    return finishData\n}\n\n// 更新布局layout\nconst updateLayout = json => {\n    return Array.from(json.objects, o => {\n        // console.log(o)\n        let no = { left: o.left, top: o.top, width: o.width, height: o.height, type: o.type };\n        if (o.type == 'textbox') {\n            no = Object.assign(no, textStyleExtract(o))\n        } else if (o.type == 'image') {\n            no = Object.assign(no, contentStyleExtract(o))\n        }\n        return no\n    });\n};\n\nasync function baseData(labVideo) {\n    // 帧数据\n    let videoObj = createFrameData(labVideo);\n    labVideo.type !== 'audio' ? videoObjId = videoObj.id : null;\n    // 去重？?\n    // if (Array.from(videos, v => v.id).includes(videoObj.id)) return console.log(labVideo);\n    if (labVideo.type == 'audio') {\n        //背景音乐\n        let element = await Lab.base.createaAudio(labVideo.url, false);\n        videoObj = Object.assign(videoObj, {\n            duration: element.duration,\n            startTime: 0,\n            loop: 5\n        })\n    };\n    return videoObj\n}\n\nfunction updateData(id, json) {\n    // console.log('更新数据',videos[id],json)\n    // console.log(updateLayout(json))\n    videos[id] = Object.assign(videos[id], {\n        layout: updateLayout(json || pc.exportJSON())\n    })\n    _save();\n}\n\nasync function baseAddBackgroundAudio(labVideo) {\n    if (audioGroup.querySelector('audio')) audioGroup.querySelector('audio').remove();\n    audioGroup.appendChild(await Lab.base.createaAudio(labVideo.url, false));\n}\n\n\nasync function baseAddVideo(labVideo, isNew = true) {\n    // console.log(labVideo)\n    //  console.log(labVideo.preview)\n    // _addVariableRect2UI(rect, videoObjId);\n    let variableRect;\n\n    if (labVideo) {\n\n        //添加到画布 \n        pc.reset();\n        // 背景\n        pc.addRect({\n            width: _WIDTH,\n            height: _HEIGHT,\n            fill: 'black',\n            stroke: 'black'\n        }, false);\n\n        // 内容\n        let { element, style } = await getContentAndStyle(labVideo);\n        // console.log(element)\n        if (labVideo.type == \"video\") {\n            pc.addVideo(element,\n                Object.assign(style, {\n                    objectCaching: false\n                }));\n        } else if (labVideo.type == \"img\") {\n            pc.addImg(element, style);\n        };\n\n        // 字幕\n        let { element: text, style: ts } = getTextAndStyle(labVideo);\n        if (text) pc.addText(text, ts);\n\n        // 变量区域\n        if (labVideo.variableRect) {\n            // console.log(variableRect)\n            variableRect = pc.addRect({\n                left: labVideo.variableRect.left,\n                top: labVideo.variableRect.top,\n                width: labVideo.variableRect.width,\n                height: labVideo.variableRect.height,\n                fill: 'rgba(0,255,0,0.3)',\n                lockMovementX: false,\n                lockRotation: false,\n                lockScalingX: false,\n                lockScalingY: false,\n            }, true, true);\n        }\n\n        //最后\n        // 创建预览图片\n        await sleep(() => (isNew === true) ? createPreviewImg(labVideo.id) : updatePreviewImg(labVideo.id), 200);\n\n    };\n\n    return variableRect;\n};\n\nfunction sleep(fn, t = 500) {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => {\n            if (fn) fn();\n            resolve();\n        }, t);\n    });\n}\n\n// 缓存\nstore.getValues().then(async vs => {\n    // console.log(vs)\n    await store.clear();\n    if (vs[0]) {\n        _WIDTH = vs[0].width;\n        _HEIGHT = vs[0].height;\n        _SCALE = vs[0].scale;\n        if (outputVideo && outputVideo.src) (outputVideo.src = vs[0].outputVideo) && outputVideo.play();\n        let ds = (vs[0].videos || []);\n        ds = ds.sort((a, b) => a.index - b.index);\n        for (let i = 0; i < ds.length; i++) {\n            videos[ds[i].id] = ds[i];\n            let variableRect;\n            if (ds[i].type === 'audio') {\n                await baseAddBackgroundAudio(ds[i]);\n            } else {\n                variableRect = await baseAddVideo(ds[i]);\n            };\n\n            videoObjId = ds[i].id;\n            // 变量\n            if (variableRect) _addVariableRect2UI(videoObjId);\n\n        };\n        _save();\n    }\n});\n// videos object转array\nfunction videos2array() {\n    let vs = [];\n    for (let id in videos) {\n        vs.push(videos[id])\n    };\n    vs = vs.sort((a, b) => a.index - b.index);\n    return vs;\n}\n// 保存\nfunction _save() {\n    let vs = videos2array();\n    store.set(storeKey, {\n        videos: vs,\n        width: _WIDTH,\n        height: _HEIGHT,\n        scale: _SCALE,\n        outputVideo: outputVideo && outputVideo.src && outputVideo.src.match('.mp4') ? outputVideo.src : null\n    });\n}\n\n",
  "code_length": 165,
  "size": [
    419,
    778
  ],
  "extname": "designlabplugin",
  "version": "0.1.1",
  "package_id": "f3d78f76c2e3b1dccd12f6d44dde02b9e3b85c22",
  "create_time": 1616232674680
}