{
  "poster": "data:image/png;base64,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",
  "knowledge": {
    "readme": "## sketch2code",
    "course": ""
  },
  "code": "// 实验\n\nvar layout, labelInput;\n\nvar group = Lab.base.createGroup();\ngroup.layout(1);\n\nvar labels = [], label;\n\n// 缓存\nvar store = new Store('layout-label-test');\n\n// 模型\nlet knn = Lab.ai.knnClassifier();\nknn.topk = 5;\n\nfunction gui() {\n  Lab.base.p5Show(false);\n\n  layout = new Canvas(300, 300);\n  Lab.base.add(layout.getElement());\n\n  layout.addText('文本');\n  layout.addRect({\n    width: 100,\n    height: 50,\n    fill: 'rgba(253,102,0,1)',\n    lockMovementX: false,\n    lockRotation: false,\n    lockScalingX: false,\n    lockScalingY: false,\n  }, true, true);\n\n  layout.onModified = async () => {\n    let data = prepareData(layout.getObjects());\n    let res = await knn.predict(data2vector(data));\n    console.log(res);\n    let id = Lab.base.hash(data);\n    let base64 = layout.toDataURL(1);\n    _createDataUI(id, data, label, base64);\n  };\n  layout.dblclick = (opt) => {\n    layout.moveToTop(opt.target);\n    //console.log(opt.target)\n  }\n\n  let pasteBtn = Lab.base.createPasteIcon(async (json) => {\n    layout.reset();\n    json = JSON.parse(json);\n    // sketch的数据转化\n    json = await sketch2karasDataProcess(json.children);\n    console.log(json)\n    let data = prepareData(json, 1);\n    await drawFn(data);\n    let res = await knn.predict(data2vector(data));\n    console.log(res);\n    let id = Lab.base.hash(data);\n    let base64 = layout.toDataURL(1);\n    _createDataUI(id, data, label, base64);\n    // let data = prepareData(json);\n    // let res = await knn.predict(data2vector(data));\n    // console.log(res);\n  }, false);\n\n  let openBtn = Lab.base.createIcon('plus', async () => {\n    let json = Lab.base.openJsonDialog();\n    if (json) {\n      await store.clear();\n      labelInput.querySelector('input').value = ''\n      resetGroup();\n      for (let v of json) {\n        await _createDataUI(v.id, v.data, v.label, v.base64)\n      };\n      saveLocal();\n    }\n  }, false);\n\n  let saveBtn = Lab.base.createIcon('save', async () => {\n    saveLocal();\n    store.getValues().then(r => {\n      Lab.base.saveJsonDialog(r, '保存')\n    })\n  }, false);\n  let trainBtn = Lab.base.createIcon('play', train, false);\n\n  let mbtns = Lab.base.createGroup(pasteBtn, openBtn, saveBtn, trainBtn);\n\n  Lab.base.add(mbtns);\n\n  labelInput = Lab.base.createInput('text', 'label', async (v) => {\n    label = v;\n    resetGroup(v);\n  });\n  Lab.base.add(labelInput);\n  Lab.base.add(group);\n\n};\n\n\n// 广度非递归遍历 \nconst travelWidely = (roots) => {\n  let res = [];\n  const queue = [...roots];\n  while (queue.length) {\n    const node = queue.shift();\n    //打印被遍历的节点\n    if (node === undefined || node.id === undefined) return res;\n    // 对节点的处理\n    res.push(node);\n    //console.log(`${node.id} ${node.children && node.children.length || \"\"}`);\n    if (node.children && node.children.length) {\n      queue.push(...node.children)\n    }\n  };\n}\n\n// 判断哪些是按钮，TODO 增加tagName的限制，提高准确率\nasync function predict(nodes) {\n\n  for (let node of nodes) {\n    let cps = sketch2karasDataReady(node.children);\n    console.log(cps);\n    for (let cp of cps) {\n      layout.reset();\n      sketch2karasDataProcess(cp);\n\n      let data = prepareData(layout.getObjects());\n      if (data.length === 2) {\n        let vector = data2vector(data);\n        console.log(data, vector);\n        let res = await knn.predict(vector);\n        console.log(Array.from(cp, c => c), res);\n\n        await sleep(1000);\n\n      }\n\n\n    }\n\n  }\n}\n\n\n// 处理成两两成组的\nfunction sketch2karasDataReady(data = []) {\n  let cps = [];\n  for (let i = 1; i < data.length; i++) {\n    let cp = [data[i - 1], data[i]];\n    cps.push(cp);\n  }\n  return cps;\n}\n\n\nasync function drawFn(data) {\n  let nd = Array.from(data, d => {\n    d.type = 'rect';\n    d.width = d.width * 100;\n    d.left = d.left * 100;\n    d.height = d.height * 100;\n    d.top = d.top * 100;\n    return d\n  })\n  await drawData(nd);\n};\n\n// 延迟\nasync function sleep(t) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve();\n    }, t);\n  })\n}\n\n// sketch的数据转化\n// type: span rect img\nasync function sketch2karasDataProcess(data = []) {\n\n  data = Array.from(data, c => {\n    let { left, top, width, height } = c.props.style;\n    let style = {\n      left, top, width, height\n    };\n\n    if (c.tagName === 'span') {\n      style.type = 'span';\n      style.text = c.children.join(\"\");\n      style.fill = c.props.style.color;\n      style.fontFamily = c.props.style.fontFamily;\n      style.fontSize = c.props.style.fontSize;\n      style.fontWeight = c.props.style.fontWeight;\n      style.lineHeight = c.props.style.lineHeight;\n      style.textAlign = c.props.style.textAlign;\n\n      // 测量文字的宽度\n      if (c.props.style._width) style.width = c.props.style._width;\n      // style.width = measureText(style.text, style.fontSize, style.fontFamily);\n\n      if (!style.height) style.height = c.props.style.fontSize * (c.props.style.lineHeight || 1);\n\n    } else if (c.tagName === 'div') {\n      style.type = 'rect';\n    } else if (c.tagName === '$polygon') {\n      style.type = 'rect';\n      //console.log(c.props)\n\n    } else if (c.tagName === 'img') {\n      style.src = c.props.src;\n      style.type = 'img';\n    }\n    return style\n  });\n\n  return data\n}\n\nasync function drawData(data = []) {\n  layout.reset();\n  console.log(data)\n  Array.from(data, async j => {\n    if (j.type === 'rect') {\n      layout.addRect(Object.assign(j, {\n        lockMovementX: false,\n        lockRotation: false,\n        lockScalingX: false,\n        lockScalingY: false,\n      }), true, true, true);\n    } else if (j.type === 'img') {\n      let im = await Lab.base.createImage(j.src);\n      layout.addAndResizeImage(im, j);\n    } else if (j.type === 'span') {\n      layout.addText(j.text, j);\n    }\n  });\n}\n\n// 创建UI\nasync function _createDataUI(id, data, label, base64) {\n\n  let element = Lab.base.createIcon('clear', () => {\n    labels = labels.filter(f => f.id !== id);\n    resetGroup(label);\n  }, false);\n  let preInfo = Lab.base.createBaseText('-');\n  let im = await Lab.base.createImage(base64);\n  const fn = async () => {\n    let res = await knn.predict(data2vector(data));\n    console.log(res)\n    if (res && res.label) preInfo.innerText = res.label;\n  };\n\n  im.addEventListener('click', () => drawFn(data));\n  im.style.width = '56px';\n  // fn();\n  let preIm = Lab.base.createGroup(element, im, preInfo);\n  preIm.layout(6)\n  group.insertAdjacentElement('afterbegin', preIm);\n\n  preInfo.addEventListener('click', fn);\n\n  labels.push({\n    id,\n    data,\n    value: label,\n    element: preIm,\n    im: im\n  });\n}\n\n// 从缓存恢复数据\nstore.getValues().then(async vs => {\n  for (let v of vs) {\n    await _createDataUI(v.id, v.data, v.label, v.base64)\n  };\n  // train();\n})\n\n// 重设UI\nfunction resetGroup(value) {\n\n  group.innerHTML = '';\n  Array.from(labels, s => {\n    if (s.value === value) {\n      group.appendChild(s.element);\n    }\n  })\n}\n\n// 数据预处理\n// type-key: span rect img\n// type:0-从layout来，1-原始json\nfunction prepareData(children, type = 0) {\n  var getType = (t) => {\n    if (t === 'textbox' || t === 'span') {\n      return 1;\n    } else if (t === 'rect' || t === 'div') {\n      return 2;\n    } else {\n      return 0\n    }\n  };\n  children = Array.from(children, c => {\n    // console.log(c)\n\n    let { left, top, width, height } = type == 0 ? c.getBoundingRect() : c;\n    return {\n      left, top, width, height, type: getType(c.type)\n    }\n  });\n  var xs = Array.from(children, c => c.left), ys = Array.from(children, c => c.top);\n  var xMin = Math.min(...xs), yMin = Math.min(...ys);\n\n  var ts = Array.from(children, t => {\n    return {\n      left: t.left - xMin,\n      top: t.top - yMin,\n      width: t.width,\n      height: t.height,\n      type: t.type\n    }\n  });\n  xs = Array.from(ts, t => t.left + t.width);\n  ys = Array.from(ts, t => t.top + t.height);\n  var xMax = Math.max(...xs),\n    yMax = Math.max(...ys);\n\n  ts = Array.from(ts, t => {\n    return {\n      left: t.left / xMax,\n      top: t.top / yMax,\n      width: t.width / xMax,\n      height: t.height / yMax,\n      _left: t.left,\n      _top: t.top,\n      _width: t.width,\n      _height: t.height,\n      type: t.type\n    }\n  })\n  return ts\n};\n\n\n// 最多4个元素，20维\nfunction data2vector(data) {\n  let keys = ['width', 'height', 'left', 'top'];\n  let vectors = [];\n  for (let t of data) {\n    if (vectors.length < 20) {\n      vectors = vectors.concat(Array.from(keys, k => t[k]));\n    }\n  };\n  if (vectors.length < 20)\n    vectors = vectors.concat((new Array(20 - vectors.length)).fill(0))\n  return vectors\n}\n\nfunction train() {\n  Array.from(labels, s => {\n    var { data, id, im, value } = s;\n    let vectors = data2vector(data);\n    knn.add(vectors, value);\n  });\n};\n\n\nfunction saveLocal() {\n  Array.from(labels, s => {\n    var { data, id, im, value } = s;\n    store.set(id, { data, id, label: value, base64: im.src })\n  })\n}\n\n\n// 测量文字的宽度\nfunction measureText(text, fontSize, fontFamily) {\n  let c = document.createElement('canvas');\n  let ctx = c.getContext('2d');\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  return ctx.measureText(text).width;\n}",
  "code_length": 96,
  "size": [
    365,
    660
  ],
  "extname": "designlabplugin",
  "version": "0.1.1",
  "package_id": "eaca5fee49e6f025c7ac31259c05039c35de2611",
  "create_time": 1615282723278
}