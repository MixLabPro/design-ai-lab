{
  "poster": "data:image/png;base64,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",
  "knowledge": {
    "readme": "## sketch2code",
    "course": ""
  },
  "code": "// 实验\n\nvar layout;\n\nvar group = Lab.base.createGroup();\ngroup.layout(1);\n\nvar labels = [], label;\n\n// 缓存\nvar store = new Store('layout-label-test');\n\n// 模型\nlet knn = Lab.ai.knnClassifier();\nknn.topk = 5;\n\nfunction gui() {\n  Lab.base.p5Show(false);\n\n  layout = new Canvas(300, 300);\n  Lab.base.add(layout.getElement());\n\n  layout.addText('文本');\n  layout.addRect({\n    width: 100,\n    height: 50,\n    fill: 'rgba(253,102,0,1)',\n    lockMovementX: false,\n    lockRotation: false,\n    lockScalingX: false,\n    lockScalingY: false,\n  }, true, true);\n\n  layout.onModified = async () => {\n    let data = prepareData(layout.getObjects());\n    let res = await knn.predict(data2vector(data));\n    console.log(res);\n    let id = Lab.base.hash(data);\n    let base64 = layout.toDataURL(1);\n    _createDataUI(id, data, label, base64);\n  };\n  layout.dblclick = (opt) => {\n    layout.moveToTop(opt.target);\n    //console.log(opt.target)\n  }\n\n  Lab.base.createPasteIcon(async (json) => {\n    layout.reset();\n    json = JSON.parse(json);\n    console.log(json)\n    // sketch的数据转化\n    sketch2karasDataProcess(json)\n    // let data = prepareData(json);\n    // let res = await knn.predict(data2vector(data));\n    // console.log(res);\n  });\n\n  let labelBtn = Lab.base.createInput('text', 'label', async (v) => {\n    label = v;\n    resetGroup(v);\n  });\n  Lab.base.add(labelBtn);\n  Lab.base.add(group);\n\n};\n\n\n// 广度非递归遍历 \nconst travelWidely = (roots) => {\n  let res = [];\n  const queue = [...roots];\n  while (queue.length) {\n    const node = queue.shift();\n    //打印被遍历的节点\n    if (node === undefined || node.id === undefined) return res;\n    // 对节点的处理\n    res.push(node);\n    //console.log(`${node.id} ${node.children && node.children.length || \"\"}`);\n    if (node.children && node.children.length) {\n      queue.push(...node.children)\n    }\n  };\n}\n\n// 判断哪些是按钮，TODO 增加tagName的限制，提高准确率\nasync function run(nodes) {\n\n  for (let node of nodes) {\n    let cps = sketch2karasDataReady(node.children);\n    console.log(cps);\n    for (let cp of cps) {\n      layout.reset();\n      sketch2karasDataProcess(cp);\n\n      let data = prepareData(layout.getObjects());\n      if (data.length === 2) {\n        let vector = data2vector(data);\n        console.log(data, vector);\n        let res = await knn.predict(vector);\n        console.log(Array.from(cp, c => c), res);\n\n        await sleep(1000);\n\n      }\n\n\n    }\n\n  }\n}\n\n\n// 处理成两两成组的\nfunction sketch2karasDataReady(data = []) {\n  let cps = [];\n  for (let i = 1; i < data.length; i++) {\n    let cp = [data[i - 1], data[i]];\n    cps.push(cp);\n  }\n  return cps;\n}\n\n\n// 延迟\nasync function sleep(t) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve();\n    }, t);\n  })\n}\n\n// sketch的数据转化\nfunction sketch2karasDataProcess(data = []) {\n\n  data = Array.from(data, c => {\n    let { left, top, width, height } = c.props.style;\n    let style = {\n      left, top, width, height\n    };\n\n    if (c.tagName === 'span') {\n      style.type = 'span';\n      style.text = c.children.join(\"\");\n      style.fill = c.props.style.color;\n      style.fontFamily = c.props.style.fontFamily;\n      style.fontSize = c.props.style.fontSize;\n      style.fontWeight = c.props.style.fontWeight;\n      style.lineHeight = c.props.style.lineHeight;\n      style.textAlign = c.props.style.textAlign;\n\n      // 测量文字的宽度\n      style.width = measureText(style.text, style.fontSize, style.fontFamily);\n\n    } else if (c.tagName === 'div') {\n      style.type = 'rect';\n    } else if (c.tagName === '$polygon') {\n      style.type = 'rect';\n      //console.log(c.props)\n\n    } else if (c.tagName === 'img') {\n      style.src = c.props.src;\n      style.type = 'img';\n    }\n    return style\n  });\n  Array.from(data, async j => {\n    if (j.type === 'rect') {\n      layout.addRect(j)\n    } else if (j.type === 'img') {\n      let im = await Lab.base.createImage(j.src);\n      layout.addAndResizeImage(im, j);\n    } else if (j.type === 'span') {\n      layout.addText(j.text, j);\n    }\n  })\n  console.log(data)\n}\n\n// 创建UI\nasync function _createDataUI(id, data, label, base64) {\n\n  let element = Lab.base.createIcon('clear', () => {\n    labels = labels.filter(f => f.id !== id);\n    resetGroup(label);\n  }, false);\n  let preInfo = Lab.base.createBaseText('-');\n  let im = await Lab.base.createImage(base64);\n  const fn = async () => {\n    let res = await knn.predict(data2vector(data));\n    console.log(res)\n    if (res && res.label) preInfo.innerText = res.label;\n  }\n  im.addEventListener('click', fn);\n  im.style.width = '56px';\n  // fn();\n  let preIm = Lab.base.createGroup(element, im, preInfo);\n  preIm.layout(6)\n  group.insertAdjacentElement('afterbegin', preIm);\n\n  labels.push({\n    id,\n    data,\n    value: label,\n    element: preIm,\n    im: im\n  });\n}\n\n// 从缓存恢复数据\nstore.getValues().then(async vs => {\n  for (let v of vs) {\n    await _createDataUI(v.id, v.data, v.label, v.base64)\n  };\n  train();\n})\n\n// 重设UI\nfunction resetGroup(value) {\n  group.innerHTML = '';\n  Array.from(labels, s => {\n    if (s.value === value) {\n      group.appendChild(s.element);\n    }\n  })\n}\n\n// 数据预处理\nfunction prepareData(children) {\n  var getType = (t) => {\n    if (t === 'textbox' || t === 'span') {\n      return 1;\n    } else if (t === 'rect' || t === 'div') {\n      return 2;\n    } else {\n      return 0\n    }\n  };\n  children = Array.from(children, c => {\n    // console.log(c)\n    let { left, top, width, height } = c.getBoundingRect();\n    return {\n      left, top, width, height, type: getType(c.type)\n    }\n  });\n  var xs = Array.from(children, c => c.left), ys = Array.from(children, c => c.top);\n  var xMin = Math.min(...xs), yMin = Math.min(...ys);\n\n  var ts = Array.from(children, t => {\n    return {\n      left: t.left - xMin,\n      top: t.top - yMin,\n      width: t.width,\n      height: t.height,\n      type: t.type\n    }\n  });\n  xs = Array.from(ts, t => t.left + t.width);\n  ys = Array.from(ts, t => t.top + t.height);\n  var xMax = Math.max(...xs),\n    yMax = Math.max(...ys);\n\n  ts = Array.from(ts, t => {\n    return {\n      left: t.left / xMax,\n      top: t.top / yMax,\n      width: t.width / xMax,\n      height: t.height / yMax,\n      type: t.type\n    }\n  })\n  return ts\n};\n\n\nfunction data2vector(data) {\n  let keys = Object.keys(data[0]);\n  let vectors = [];\n  for (let t of data) {\n    vectors = vectors.concat(Array.from(keys, k => t[k]));\n  }\n  return vectors\n}\n\nfunction train() {\n  Array.from(labels, s => {\n    var { data, id, im, value } = s;\n    let vectors = data2vector(data);\n    knn.add(vectors, value);\n  });\n};\n\n\nfunction saveLocal() {\n  Array.from(labels, s => {\n    var { data, id, im, value } = s;\n    store.set(id, { data, id, label: value, base64: im.src })\n  })\n}\n\n\n// 测量文字的宽度\nfunction measureText(text, fontSize, fontFamily) {\n  let c = document.createElement('canvas');\n  let ctx = c.getContext('2d');\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  return ctx.measureText(text).width;\n}",
  "code_length": 82,
  "size": [
    365,
    660
  ],
  "extname": "designlabplugin",
  "version": "0.1.1",
  "package_id": "b2115e53944d487b79fb713372173bdf63969bc9",
  "create_time": 1614997858468
}