{
  "poster": "data:image/png;base64,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",
  "knowledge": {
    "readme": "## 组合关系评分\n\n### 研究布局",
    "course": "\n\n- 自动监听剪切板，收集图片\n- 轮廓比较，结果越低，匹配越好\n\n"
  },
  "code": "// 画布大小\nlet _WIDTH = 240, _HEIGHT = 240;\n\n// 提示信息\nlet info, canvas,layout;\n\n// 所有图片\nvar imagesDict = {};\n\n// 存储图片特征\nvar features = {\n    1: null,\n    2: null\n};\n\n// 分类模型\nvar knnModel = Lab.ai.knnClassifier();\nknnModel.topk = 5;\nvar imgModel = new Lab.ai.Mobilenet();\nPromise.all([\n    knnModel.loadFromStore('test'),\n    imgModel.init()\n]).then(() => {\n    // knnModel.minDataset();\n    info.innerText = '开始使用';\n});\n\nfunction gui() {\n\n    //隐藏p5的画布\n    Lab.base.p5Show(false);\n    Lab.base.layout(0);\n    Lab.base.loading(0);\n\n    canvas = new Canvas(_WIDTH, _HEIGHT);\n    canvas.dblclick = opt => {\n        canvas.moveToTop(opt.target);\n    };\n \n    info = Lab.base.createBaseText('加载ing');\n\n    //打标\n    let good = Lab.base.createButton('正样本', () => {\n        let gt = new Store('good');\n        let data = {\n            img1: features[1].img.src,\n            img2: features[2].img.src,\n            img3: features[3].src\n        }\n        gt.set(Lab.base.hash(data), data);\n    }, false);\n    let bad = Lab.base.createButton('负样本', () => {\n        let bt = new Store('bad');\n        let data = {\n            img1: features[1].img.src,\n            img2: features[2].img.src,\n            img3: features[3].src\n        }\n        bt.set(Lab.base.hash(data), data);\n    }, false);\n    good.style.fontSize = '12px';\n    bad.style.fontSize = '12px';\n\n    let infoAndTag = Lab.base.createGroup(info, good, bad);\n\n    // 下一张组合\n    //创建图标\n    let refresh = Lab.base.createIcon('refresh', async () => {\n\n        if(!layout) {\n            layout = Array.from(canvas.getObjects(),o=>{\n                const {left,top,width,height}=o.getBoundingRect();\n                return {\n                    left:left+canvas.canvas.vptCoords.tl.x,\n                    top:top+canvas.canvas.vptCoords.tl.y,\n                    width,height\n                }\n            });\n             \n            canvas.reset();\n        };\n\n        await create();\n\n    }, false);\n\n    let addRectBtn = Lab.base.createIcon('plus', () => {\n        canvas.addRect({\n            width: 100,\n            height: 100,\n            fill: 'rgba(255,0,0,0.1)',\n            lockMovementX: false,\n            lockScalingX: false,\n            lockScalingY: false,\n        }, true, true, false);\n    }, false);\n\n    refresh.style.width = '50%';\n    let test = Lab.base.createIcon('light', async () => {\n        for (let i = 0; i < 10; i++) {\n            await create();\n        }\n    }, false);\n\n    let mainGroup = Lab.base.createGroup(\n        canvas.getElement(), infoAndTag,\n        Lab.base.createGroup(refresh, addRectBtn), test\n    );\n    mainGroup.layout('g37');\n    mainGroup.style.width = '80%';\n    Lab.base.add(\n        mainGroup\n    );\n\n\n    // 清空图片\n    let clear = Lab.base.createIcon('clear', () => {\n        // 清空缓存\n        Lab.base.clipboard.clearStore('img');\n        for (let id in imagesDict) {\n            imagesDict[id].remove();\n        };\n    }, false);\n    // 训练\n    let train = Lab.base.createIcon('play', async () => {\n        train.setAttribute('disabled', true);\n\n        let data = await new Store('good').getValues();\n        for (let d of data) {\n            let img = await Lab.base.createImage(d.img3);\n            let tensor = await feature(img);\n            knnModel.add(tensor, 'good');\n        }\n        data = await new Store('bad').getValues();\n        for (let d of data) {\n            let img = await Lab.base.createImage(d.img3);\n            let tensor = await feature(img);\n            knnModel.add(tensor, 'bad');\n        };\n        train.removeAttribute('disabled');\n        knnModel.save('test');\n        alert('完成训练');\n    }, false);\n\n    let btns = Lab.base.createGroup(train, clear);\n    train.style.width = '56px';\n    clear.style.width = '56px';\n    btns.layout(0);\n    Lab.base.add(btns);\n\n\n    // 监听剪切板\n    Lab.base.clipboard.listener('img', async (nativeImage) => {\n        let url = nativeImage.toDataURL();\n        // console.log(nativeImage.toDataURL())\n        //创建图片\n        await addImg(url);\n    });\n\n    // 获取缓存\n    Lab.base.clipboard.getAllStore('img').then(json => {\n        let imgs = [];\n        let sum = Object.keys(json).length;\n        let count = 5;\n\n        for (let id in json) {\n            if (count < 0) return loadImageByBatch(imgs, 6);\n            count--;\n            let base64 = json[id];\n            imgs.push(base64);\n        };\n\n        loadImageByBatch(imgs, sum);\n    });\n\n    // 分批加载\n    function loadImageByBatch(imgs = [], sum = 1) {\n\n        let bs = Array.from(new Array(8), i => imgs.pop()).filter(f => f);\n        // console.log(bs,sum)\n        Promise.all(\n            Array.from(bs, im => addImg(im))\n        ).then(() => {\n\n            if (imgs.length <= 0) {\n                Lab.base.loading(100);\n                info.innerText = `${Object.keys(imagesDict).length}张图`;\n            } else {\n                info.innerText = `${parseInt(100 * Object.keys(imagesDict).length / sum)}%`;\n                setTimeout(() => {\n                    loadImageByBatch(imgs, sum);\n                }, 1000 + Math.random() * 10)\n            }\n\n        });\n\n    }\n\n    // 图片 预处理\n    async function addImg(url) {\n        let id = Lab.base.md5(url);\n        if (imagesDict[id]) return;\n        let img = await Lab.base.createImage(url);\n        img.style.width = \"88px\";\n        img.style.margin = \"8px\";\n        img.id = id;\n        // let cannyImg = await imgProcess(img);\n        // let { thresholdImg, res } = await threshold(img, 100, 100);\n        // let g = Lab.base.createGroup(img, cannyImg, thresholdImg);\n        imagesDict[id] = img;\n    }\n\n    // 合图\n    async function create() {\n        // var objects = canvas.exportJSON().objects;\n        if (layout) {\n            features[1] = randomOne();\n            features[2] = randomOne();\n            // 缩放图片\n            // canvas.resizeImage(features[1].img,layout[0].left,layout[0].top,layout[0].width,layout[0].height);\n            \n            canvas.addImg(features[1].img, layout[0]);\n            canvas.addImg(features[2].img, layout[1]);\n            // 合图后\n            features[3] = await Lab.base.createImage(canvas.toDataURL(1));\n            let score = await knnModel.predict(\n                await feature(features[3])\n            );\n            let { res } = await threshold(features[3], 100, 100);\n            info.innerText = `评分:${score.confidences.good} ${res.area / 10000}`;\n        }\n    }\n}\n\n// 尝试下打标，把构图比较好的轮廓作为参考，比较轮廓\n// 抽取特征\nasync function feature(img) {\n    //img = await imgProcess(img);\n    let tensor = imgModel.infer(img);\n    return tensor\n}\n\n// 边缘检测\nasync function imgProcess(img) {\n    //创建画布\n    let canvas = Lab.base.createCanvas(img.naturalWidth, img.naturalHeight, 'myCanvas', '', false);\n    let src = cv.imread(img);\n\n    // 缩放为100x100方形\n    let rdst = new cv.Mat();\n    let dsize = new cv.Size(100, 100);\n    // You can try more different parameters\n    cv.resize(src, rdst, dsize, 0, 0, cv.INTER_AREA);\n\n    let dst = new cv.Mat();\n    cv.cvtColor(rdst, rdst, cv.COLOR_RGB2GRAY, 0);\n    // You can try more different parameters\n    cv.Canny(rdst, dst, 50, 100, 3, false);\n\n    cv.imshow(canvas, dst);\n\n    let url = canvas.toDataURL();\n    let cannyImg = await Lab.base.createImage(url);\n    //img.insertAdjacentElement('afterend',cannyImg);\n    // console.log(cannyImg);\n    src.delete();\n    rdst.delete();\n    dst.delete();\n    canvas.remove();\n    return cannyImg;\n}\n\n// 阈值分割\nasync function threshold(img, w, h) {\n    //创建画布\n    let canvas = Lab.base.createCanvas(img.naturalWidth, img.naturalHeight, 'myCanvas', '', false);\n    let src = cv.imread(img);\n    cv.cvtColor(src, src, cv.COLOR_RGBA2GRAY, 0);\n\n    // 缩放为100x100方形\n    let rdst = new cv.Mat();\n    let dsize = new cv.Size(w, h);\n    // You can try more different parameters\n    cv.resize(src, rdst, dsize, 0, 0, cv.INTER_AREA);\n\n    let dst = new cv.Mat();\n    // You can try more different parameters\n    cv.threshold(rdst, dst, 10, 100, cv.THRESH_BINARY);\n    cv.imshow(canvas, dst);\n\n    let url = canvas.toDataURL();\n    let thresholdImg = await Lab.base.createImage(url);\n\n    // console.log(area(dst))\n    let res = area(dst);\n    // res=res/(w*h);\n\n    rdst.delete();\n    src.delete();\n    canvas.remove();\n    //dst.delete();\n    return { thresholdImg, res: res };\n}\n\n// 轮廓\nfunction area(src) {\n    let values = [];\n    let contours = new cv.MatVector();\n    let hierarchy = new cv.Mat();\n    cv.findContours(src, contours, hierarchy, cv.RETR_CCOMP, cv.CHAIN_APPROX_SIMPLE);\n\n    for (let i = 0; i < contours.size(); i++) {\n        let cnt = contours.get(i);\n        let area = cv.contourArea(cnt, false);\n        values.push({\n            area: area,\n            cnt: cnt\n        });\n    };\n    values = values.sort((b, a) => a.area - b.area)\n    src.delete();\n    contours.delete();\n    hierarchy.delete();\n    return values[0]\n}\n\n//  比较两个轮廓\nfunction compare(cnt1, cnt2) {\n    let result = cv.matchShapes(cnt1, cnt2, 1, 0);\n    return result;\n}\n\nfunction randomOne() {\n    let imgs = [];\n    for (let id in imagesDict) {\n        let img = imagesDict[id];\n        imgs.push({ img, id });\n    };\n    return imgs[parseInt(Math.random() * imgs.length)];\n}",
  "code_length": 112,
  "size": [
    414,
    605
  ],
  "extname": "designlabplugin",
  "version": "0.1.1",
  "package_id": "7c793a2ffddad36ae672161f214f3623195978b7",
  "create_time": 1614252941254
}